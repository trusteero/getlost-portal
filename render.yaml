services:
  # Web Service for Next.js application
  # Updated: Fixed BETTER_AUTH_URL and NEXT_PUBLIC_APP_URL to use full URL
  # Fixed: Admin users route to use Better Auth account table schema
  - type: web
    name: getlostportal
    runtime: node
    region: oregon # or your preferred region
    plan: starter # Upgraded to Starter plan for persistent disk support
    buildCommand: chmod +x scripts/render-build.sh && ./scripts/render-build.sh
    startCommand: chmod +x scripts/render-init.sh && ./scripts/render-init.sh && npm run start
    healthCheckPath: /
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        value: file:/var/data/db.sqlite
      - key: BETTER_AUTH_URL
        fromService:
          type: web
          name: getlostportal
          property: url
      - key: NEXT_PUBLIC_APP_URL
        fromService:
          type: web
          name: getlostportal
          property: url
      - key: CUSTOM_DOMAIN
        sync: false # Set to your custom domain (e.g., portal.getlost.ink) if using one
      - key: NEXT_PUBLIC_CUSTOM_DOMAIN
        sync: false # Set to your custom domain (e.g., portal.getlost.ink) if using one
      - key: AUTH_SECRET
        generateValue: true
      - key: TURSO_DATABASE_URL
        sync: false # Set this in Render dashboard
      - key: TURSO_AUTH_TOKEN
        sync: false # Set this in Render dashboard
      - key: AUTH_GOOGLE_ID
        sync: false # Set this in Render dashboard
      - key: AUTH_GOOGLE_SECRET
        sync: false # Set this in Render dashboard
      - key: GMAIL_USER
        sync: false # Set this in Render dashboard
      - key: GMAIL_PASS
        sync: false # Set this in Render dashboard
      - key: SUPER_ADMIN_EMAILS
        sync: false # Set this in Render dashboard
      - key: NEXT_PUBLIC_SUPER_ADMIN_EMAILS
        sync: false # Set this in Render dashboard
      - key: BOOKDIGEST_URL
        value: https://bookdigest.onrender.com
      - key: BOOKDIGEST_API_KEY
        sync: false # Set this in Render dashboard
      - key: RESEND_API_KEY
        sync: false # Set this in Render dashboard
      - key: RESEND_FROM_EMAIL
        sync: false # Set this in Render dashboard (e.g., noreply@yourdomain.com or onboarding@resend.dev for testing)
      - key: STRIPE_SECRET_KEY
        sync: false # Set this in Render dashboard (optional - for Stripe payments)
      - key: NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
        sync: false # Set this in Render dashboard (optional - for Stripe payments)
      - key: STRIPE_WEBHOOK_SECRET
        sync: false # Set this in Render dashboard (optional - for Stripe webhooks)
      - key: USE_SIMULATED_PURCHASES
        sync: false # Set to "true" to force simulated purchases (for testing)
      - key: OPENAI_API_KEY
        sync: false # Set this in Render dashboard
      - key: ANTHROPIC_API_KEY
        sync: false # Set this in Render dashboard
      - key: BOOK_STORAGE_PATH
        value: /var/data/books
      - key: COVER_STORAGE_PATH
        value: /var/data/covers
      - key: REPORT_STORAGE_PATH
        value: /var/data/reports
      - key: UPLOAD_DIR
        value: /var/data/uploads
      - key: BOOK_REPORTS_PATH
        value: /var/data/book-reports
    disk:
      name: getlostportal-uploads
      mountPath: /var/data
      sizeGB: 1 # Adjust based on your needs

# Database (if using Render's PostgreSQL instead of Turso)
# Uncomment if you want to use Render's database
# databases:
#   - name: getlostportal-db
#     databaseName: getlostportal
#     user: getlostportal
#     region: oregon
#     plan: free # or starter/standard/pro